# docker-compose.yml

version: '3.8'
services:
  # 1. Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ (app)
  app:
    build: .                 # í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ Dockerfileì„ ì‚¬ìš©í•´ ì´ë¯¸ì§€ ë¹Œë“œ
    container_name: my-spring-app
    ports:
      - "8080:8080"          # Windows í˜¸ìŠ¤íŠ¸ í¬íŠ¸ -> ì»¨í…Œì´ë„ˆ í¬íŠ¸ ì—°ê²°
    depends_on:
      db:
        condition: service_healthy # DBê°€ ë¨¼ì € ì‹œì‘ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
    environment:
      # ğŸš¨ application.ymlì˜ ${} ë³€ìˆ˜ì— ì£¼ì…í•  ì‹¤ì œ ê°’
      SPRING_DATASOURCE_URL: jdbc:mysql://db:3306/university?useUnicode=true&characterEncoding=utf8  # 'db'ëŠ” MySQL ì„œë¹„ìŠ¤ ì´ë¦„
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: aa456456!

  # 2. MySQL ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ (db)
  db:
    image: mysql:8.0         # MySQL 8.0 ê³µì‹ ì´ë¯¸ì§€ ì‚¬ìš©
    container_name: mysql-db
    ports:
      - "3307:3306"          # ë¡œì»¬ DB íˆ´ ì ‘ì†ìš© í¬íŠ¸ (ì„ íƒ ì‚¬í•­)
    environment:
      MYSQL_DATABASE: university
      #MYSQL_USER: root
      #MYSQL_PASSWORD: aa456456!
      MYSQL_ROOT_PASSWORD: aa456456!
    # ì»¨í…Œì´ë„ˆ ì‚­ì œ ì‹œì—ë„ ë°ì´í„° ìœ ì‹¤ ë°©ì§€ë¥¼ ìœ„í•œ ë³¼ë¥¨ ì„¤ì •
    volumes:
      - mysql_data:/var/lib/mysql
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$MYSQL_ROOT_PASSWORD" ]
      timeout: 10s
      retries: 10
      start_period: 20s # MySQL ì´ˆê¸°í™”ì— í•„ìš”í•œ ì¶©ë¶„í•œ ì‹œê°„ (20ì´ˆ)

volumes:
  mysql_data: